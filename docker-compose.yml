version: "3"

services:
  base:
    build:
      context: base
      dockerfile: Dockerfile
    image: ${BASE_IMAGE}:${BASE_IMAGE_TAG}
  was_builder:
    build:
      context: builder
      dockerfile: Dockerfile
    env_file:
    - .env
    - .env.mysql
    image: ${WAS_IMAGE}:${WAS_IMAGE_TAG}.builder
    volumes:
    - "${HOME}/.docker:/root/.docker"
  was:
    image: ${WAS_IMAGE}:${WAS_IMAGE_TAG}
    ports:
    - 8080:8080
    user: "1000:1000"
    env_file:
    - .env
    - .env.mysql
    restart: always
    volumes:
    - "/logs:/var/log/petclinic"
  mysql:
    image: mysql:8.0
    ports:
    - 3306:${MYSQL_PORT}
    env_file:
    - .env.mysql
    volumes:
    - "./mysql/conf.d:/etc/mysql/conf.d:ro"
    - "/mnt/petclinic/mysql:/var/lib/mysql"